{% extends "base.html" %}

{% block nav %}
<nav class="hidden md:flex ml-10 space-x-8">
    <a href="/lp-portal" class="text-navy-600 hover:text-navy-900 text-sm">Dashboard</a>
    <a href="/lp-portal/funds" class="text-navy-600 hover:text-navy-900 text-sm">Funds</a>
    <a href="/lp-portal/mandate" class="text-gold font-medium text-sm">Investment Mandate</a>
    <a href="/lp-portal/meetings" class="text-navy-600 hover:text-navy-900 text-sm">Meetings</a>
</nav>
{% endblock %}

{% block mobile_nav %}
<a href="/lp-portal" class="block py-2 px-3 rounded-lg text-navy-600 hover:bg-navy-100">Dashboard</a>
<a href="/lp-portal/funds" class="block py-2 px-3 rounded-lg text-navy-600 hover:bg-navy-100">Funds</a>
<a href="/lp-portal/mandate" class="block py-2 px-3 rounded-lg bg-gold/10 text-gold font-medium">Investment Mandate</a>
<a href="/lp-portal/meetings" class="block py-2 px-3 rounded-lg text-navy-600 hover:bg-navy-100">Meetings</a>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 py-8">
    {% set breadcrumbs = [{"label": "LP Portal", "url": "/lp-portal"}, {"label": "Investment Mandate"}] %}
    {% include "partials/breadcrumb.html" %}

    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-2xl font-bold text-navy-900 dark:text-white">Investment Mandate</h1>
            <p class="text-navy-500 dark:text-navy-400 mt-1">Define your investment preferences to receive better fund matches</p>
        </div>
        <span class="px-3 py-1 text-sm bg-green-100 text-green-700 rounded-full">
            {{ mandate.status or 'Active' }}
        </span>
    </div>

    <form id="mandate-form" data-validate class="space-y-6">
        <!-- Strategy Preferences -->
        <div class="card p-6">
            <h2 class="text-lg font-semibold text-navy-900 dark:text-white mb-4 flex items-center">
                <span class="w-8 h-8 rounded-full bg-gold text-white text-sm flex items-center justify-center mr-3">1</span>
                Strategy Preferences
            </h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-navy-700 dark:text-navy-300 mb-2">Target Strategies</label>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                        {% for strategy in ['Buyout', 'Growth Equity', 'Venture Capital', 'Private Credit', 'Real Estate', 'Infrastructure', 'Secondaries', 'Fund of Funds'] %}
                        <label class="flex items-center p-3 border border-navy-200 dark:border-navy-700 rounded-lg hover:bg-navy-50 dark:hover:bg-navy-800 cursor-pointer">
                            <input type="checkbox" name="strategies" value="{{ strategy|lower|replace(' ', '_') }}"
                                   class="rounded border-navy-300 text-gold focus:ring-gold mr-2"
                                   {{ 'checked' if strategy|lower|replace(' ', '_') in (mandate.strategies or []) else '' }}>
                            <span class="text-sm text-navy-700 dark:text-navy-300">{{ strategy }}</span>
                        </label>
                        {% endfor %}
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-navy-700 dark:text-navy-300 mb-1">Minimum IRR Target (%)</label>
                        <input type="number" name="min_irr" min="0" max="100" step="0.5"
                               value="{{ mandate.min_irr or 15 }}" class="form-input">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-navy-700 dark:text-navy-300 mb-1">Target MOIC</label>
                        <input type="number" name="target_moic" min="1" max="10" step="0.1"
                               value="{{ mandate.target_moic or 2.0 }}" class="form-input">
                    </div>
                </div>
            </div>
        </div>

        <!-- Geographic Focus -->
        <div class="card p-6">
            <h2 class="text-lg font-semibold text-navy-900 dark:text-white mb-4 flex items-center">
                <span class="w-8 h-8 rounded-full bg-gold text-white text-sm flex items-center justify-center mr-3">2</span>
                Geographic Focus
            </h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-navy-700 dark:text-navy-300 mb-2">Target Regions</label>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                        {% for region in ['North America', 'Europe', 'Asia Pacific', 'Latin America', 'Middle East', 'Africa'] %}
                        <label class="flex items-center p-3 border border-navy-200 dark:border-navy-700 rounded-lg hover:bg-navy-50 dark:hover:bg-navy-800 cursor-pointer">
                            <input type="checkbox" name="regions" value="{{ region|lower|replace(' ', '_') }}"
                                   class="rounded border-navy-300 text-gold focus:ring-gold mr-2"
                                   {{ 'checked' if region|lower|replace(' ', '_') in (mandate.regions or ['north_america', 'europe']) else '' }}>
                            <span class="text-sm text-navy-700 dark:text-navy-300">{{ region }}</span>
                        </label>
                        {% endfor %}
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-navy-700 dark:text-navy-300 mb-1">Excluded Countries (comma-separated)</label>
                    <input type="text" name="excluded_countries" placeholder="e.g., Russia, Belarus"
                           value="{{ mandate.excluded_countries or '' }}" class="form-input">
                </div>
            </div>
        </div>

        <!-- Commitment Parameters -->
        <div class="card p-6">
            <h2 class="text-lg font-semibold text-navy-900 dark:text-white mb-4 flex items-center">
                <span class="w-8 h-8 rounded-full bg-gold text-white text-sm flex items-center justify-center mr-3">3</span>
                Commitment Parameters
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-navy-700 dark:text-navy-300 mb-1">Min Commitment ($M)</label>
                    <input type="number" name="min_commitment_mm" min="0" step="1"
                           value="{{ mandate.min_commitment_mm or 10 }}" class="form-input">
                </div>
                <div>
                    <label class="block text-sm font-medium text-navy-700 dark:text-navy-300 mb-1">Max Commitment ($M)</label>
                    <input type="number" name="max_commitment_mm" min="0" step="1"
                           value="{{ mandate.max_commitment_mm or 100 }}" class="form-input">
                </div>
                <div>
                    <label class="block text-sm font-medium text-navy-700 dark:text-navy-300 mb-1">Min Fund Size ($M)</label>
                    <input type="number" name="min_fund_size_mm" min="0" step="1"
                           value="{{ mandate.min_fund_size_mm or 100 }}" class="form-input">
                </div>
                <div>
                    <label class="block text-sm font-medium text-navy-700 dark:text-navy-300 mb-1">Max Fund Size ($M)</label>
                    <input type="number" name="max_fund_size_mm" min="0" step="1"
                           value="{{ mandate.max_fund_size_mm or 2000 }}" class="form-input">
                </div>
            </div>
        </div>

        <!-- GP Requirements -->
        <div class="card p-6">
            <h2 class="text-lg font-semibold text-navy-900 dark:text-white mb-4 flex items-center">
                <span class="w-8 h-8 rounded-full bg-gold text-white text-sm flex items-center justify-center mr-3">4</span>
                GP Requirements
            </h2>
            <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-navy-700 dark:text-navy-300 mb-1">Min Track Record (years)</label>
                        <input type="number" name="min_track_record_years" min="0" max="50"
                               value="{{ mandate.min_track_record_years or 5 }}" class="form-input">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-navy-700 dark:text-navy-300 mb-1">Min Prior Funds</label>
                        <input type="number" name="min_prior_funds" min="0" max="20"
                               value="{{ mandate.min_prior_funds or 1 }}" class="form-input">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-navy-700 dark:text-navy-300 mb-2">Manager Preferences</label>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" name="first_time_managers" class="rounded border-navy-300 text-gold focus:ring-gold mr-2"
                                   {{ 'checked' if mandate.first_time_managers else '' }}>
                            <span class="text-sm text-navy-700 dark:text-navy-300">Open to first-time managers (with strong team)</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" name="emerging_managers" class="rounded border-navy-300 text-gold focus:ring-gold mr-2"
                                   {{ 'checked' if mandate.emerging_managers else '' }}>
                            <span class="text-sm text-navy-700 dark:text-navy-300">Interested in emerging managers</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" name="co_investment" class="rounded border-navy-300 text-gold focus:ring-gold mr-2"
                                   {{ 'checked' if mandate.co_investment else '' }}>
                            <span class="text-sm text-navy-700 dark:text-navy-300">Require co-investment opportunities</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- ESG Requirements -->
        <div class="card p-6">
            <h2 class="text-lg font-semibold text-navy-900 dark:text-white mb-4 flex items-center">
                <span class="w-8 h-8 rounded-full bg-gold text-white text-sm flex items-center justify-center mr-3">5</span>
                ESG & Exclusions
            </h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-navy-700 dark:text-navy-300 mb-1">ESG Policy</label>
                    <select name="esg_policy" class="form-input">
                        <option value="none" {{ 'selected' if mandate.esg_policy == 'none' else '' }}>No specific requirements</option>
                        <option value="consider" {{ 'selected' if mandate.esg_policy == 'consider' else '' }}>Consider ESG factors</option>
                        <option value="require" {{ 'selected' if mandate.esg_policy == 'require' else '' }}>Require ESG integration</option>
                        <option value="impact" {{ 'selected' if mandate.esg_policy == 'impact' else '' }}>Impact-focused only</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-navy-700 dark:text-navy-300 mb-2">Sector Exclusions</label>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                        {% for sector in ['Tobacco', 'Weapons', 'Fossil Fuels', 'Gambling', 'Adult Entertainment', 'Alcohol'] %}
                        <label class="flex items-center p-3 border border-red-200 dark:border-red-900 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 cursor-pointer">
                            <input type="checkbox" name="exclusions" value="{{ sector|lower|replace(' ', '_') }}"
                                   class="rounded border-red-300 text-red-500 focus:ring-red-500 mr-2"
                                   {{ 'checked' if sector|lower|replace(' ', '_') in (mandate.exclusions or ['tobacco', 'weapons']) else '' }}>
                            <span class="text-sm text-red-700 dark:text-red-300">{{ sector }}</span>
                        </label>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Notes -->
        <div class="card p-6">
            <h2 class="text-lg font-semibold text-navy-900 dark:text-white mb-4 flex items-center">
                <span class="w-8 h-8 rounded-full bg-gold text-white text-sm flex items-center justify-center mr-3">6</span>
                Additional Notes
            </h2>
            <textarea name="notes" rows="4" class="form-input"
                      placeholder="Any additional requirements, preferences, or context for fund managers...">{{ mandate.notes or '' }}</textarea>
        </div>

        <!-- Actions -->
        <div class="flex justify-between items-center">
            <p class="text-sm text-navy-500 dark:text-navy-400">
                Last updated: {{ mandate.updated_at or 'Never' }}
            </p>
            <div class="flex space-x-3">
                <button type="button" onclick="location.reload()" class="btn-secondary">Reset</button>
                <button type="submit" class="btn-primary">Save Mandate</button>
            </div>
        </div>
    </form>
</div>

<script>
document.getElementById('mandate-form').addEventListener('submit', function(e) {
    e.preventDefault();
    // Would submit via HTMX or fetch in real implementation
    showToast('Investment mandate saved successfully', 'success');
});
</script>
{% endblock %}
