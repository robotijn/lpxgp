{% extends "base.html" %}

{% block nav %}
<nav class="hidden md:flex ml-10 space-x-8">
    <a href="/dashboard" class="text-navy-600 hover:text-navy-900 text-sm">Dashboard</a>
    <a href="/matches" class="text-navy-600 hover:text-navy-900 text-sm">Matches</a>
    <a href="/funds" class="text-navy-600 hover:text-navy-900 text-sm">Funds</a>
    <a href="/lps" class="text-navy-600 hover:text-navy-900 text-sm">LPs</a>
    <a href="/shortlist" class="text-gold font-medium text-sm">Shortlist</a>
</nav>
{% endblock %}

{% block mobile_nav %}
<a href="/dashboard" class="block py-2 px-3 rounded-lg text-navy-600 hover:bg-navy-100">Dashboard</a>
<a href="/matches" class="block py-2 px-3 rounded-lg text-navy-600 hover:bg-navy-100">Matches</a>
<a href="/funds" class="block py-2 px-3 rounded-lg text-navy-600 hover:bg-navy-100">Funds</a>
<a href="/lps" class="block py-2 px-3 rounded-lg text-navy-600 hover:bg-navy-100">LPs</a>
<a href="/shortlist" class="block py-2 px-3 rounded-lg bg-gold/10 text-gold font-medium">Shortlist</a>
{% endblock %}

{% block header_right %}
<div class="flex items-center space-x-4">
    <a href="/settings" class="text-navy-600 hover:text-navy-900 text-sm hidden md:inline">
        {{ user.name }}
    </a>
    <a href="/logout" class="btn-secondary text-sm">Sign Out</a>
</div>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 py-8">
    <!-- Page Header -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8">
        <div>
            <h1 class="text-2xl font-bold text-navy-900">Shortlist</h1>
            <p class="text-navy-500 mt-1">LPs you've saved for follow-up</p>
        </div>
        {% if stats.total > 0 %}
        <button onclick="if(confirm('Clear all items from your shortlist?')) { fetch('/api/shortlist', {method: 'DELETE'}).then(() => location.reload()) }"
                class="btn-secondary text-sm">
            Clear All
        </button>
        {% endif %}
    </div>

    <!-- Stats -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
        <div class="card p-4">
            <div class="text-2xl font-bold text-navy-900">{{ stats.total }}</div>
            <div class="text-sm text-navy-500">Saved LPs</div>
        </div>
        <div class="card p-4">
            <div class="text-2xl font-bold text-gold">{{ stats.high_priority }}</div>
            <div class="text-sm text-navy-500">High Priority</div>
        </div>
        <div class="card p-4">
            <div class="text-2xl font-bold text-navy-900">{{ stats.with_notes }}</div>
            <div class="text-sm text-navy-500">With Notes</div>
        </div>
    </div>

    <!-- Shortlist Items -->
    {% if items %}
    <div class="space-y-4">
        {% for entry in items %}
        <div class="card p-5 hover:shadow-md transition-shadow" id="shortlist-item-{{ entry.item.lp_id }}">
            <div class="flex flex-col sm:flex-row sm:items-start gap-4">
                <!-- LP Info -->
                <div class="flex-1">
                    <div class="flex items-start justify-between">
                        <div>
                            <h3 class="font-semibold text-navy-900 text-lg">
                                {{ entry.lp.name if entry.lp.name else 'Unknown LP' }}
                            </h3>
                            <p class="text-sm text-navy-500">
                                {% if entry.lp.hq_city %}{{ entry.lp.hq_city }}{% endif %}
                                {% if entry.lp.hq_country %}, {{ entry.lp.hq_country }}{% endif %}
                            </p>
                        </div>
                        <!-- Priority Badge -->
                        <span class="px-2 py-1 text-xs font-medium rounded-full
                            {% if entry.item.priority == 1 %}bg-red-100 text-red-700
                            {% elif entry.item.priority == 2 %}bg-yellow-100 text-yellow-700
                            {% else %}bg-gray-100 text-gray-700{% endif %}">
                            {% if entry.item.priority == 1 %}High
                            {% elif entry.item.priority == 2 %}Medium
                            {% else %}Low{% endif %} Priority
                        </span>
                    </div>

                    <!-- LP Details -->
                    <div class="mt-3 grid grid-cols-2 sm:grid-cols-4 gap-3 text-sm">
                        <div>
                            <div class="text-navy-500">Type</div>
                            <div class="font-medium text-navy-900">
                                {{ entry.lp.lp_type|title if entry.lp.lp_type else '-' }}
                            </div>
                        </div>
                        <div>
                            <div class="text-navy-500">AUM</div>
                            <div class="font-medium text-navy-900">
                                {% if entry.lp.total_aum_bn %}${{ entry.lp.total_aum_bn }}B{% else %}-{% endif %}
                            </div>
                        </div>
                        <div>
                            <div class="text-navy-500">PE Allocation</div>
                            <div class="font-medium text-navy-900">
                                {% if entry.lp.pe_allocation_pct %}{{ entry.lp.pe_allocation_pct }}%{% else %}-{% endif %}
                            </div>
                        </div>
                        <div>
                            <div class="text-navy-500">Check Size</div>
                            <div class="font-medium text-navy-900">
                                {% if entry.lp.check_size_min_mm or entry.lp.check_size_max_mm %}
                                ${{ entry.lp.check_size_min_mm or '?' }}-{{ entry.lp.check_size_max_mm or '?' }}M
                                {% else %}-{% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Notes -->
                    {% if entry.item.notes %}
                    <div class="mt-3 p-3 bg-navy-50 rounded-lg">
                        <div class="text-xs text-navy-500 mb-1">Notes</div>
                        <p class="text-sm text-navy-700">{{ entry.item.notes }}</p>
                    </div>
                    {% endif %}

                    <!-- Added Date -->
                    <div class="mt-3 text-xs text-navy-400">
                        Added {{ entry.item.added_at[:10] if entry.item.added_at else 'recently' }}
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex sm:flex-col gap-2 sm:gap-3">
                    <a href="/lps" class="btn-secondary text-sm">View LP</a>
                    <button onclick="removeFromShortlist('{{ entry.item.lp_id }}')"
                            class="text-sm text-red-500 hover:text-red-700 px-3 py-2">
                        Remove
                    </button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="card p-12 text-center">
        <svg class="w-16 h-16 text-navy-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
        </svg>
        <h3 class="text-lg font-semibold text-navy-900 mb-2">No saved LPs yet</h3>
        <p class="text-navy-500 mb-6">
            Browse LPs and click the save button to add them to your shortlist.
        </p>
        <a href="/lps" class="btn-primary">Browse LPs</a>
    </div>
    {% endif %}
</div>

<script>
function removeFromShortlist(lpId) {
    if (confirm('Remove this LP from your shortlist?')) {
        fetch('/api/shortlist/' + lpId, { method: 'DELETE' })
            .then(response => {
                if (response.ok) {
                    document.getElementById('shortlist-item-' + lpId).remove();
                    // Check if list is now empty
                    if (document.querySelectorAll('[id^="shortlist-item-"]').length === 0) {
                        location.reload();
                    }
                }
            });
    }
}
</script>
{% endblock %}
